<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>窗户模拟展示</title>
	<!-- <link rel="stylesheet" href="assets/css/main.css" /> -->
</head>
<style type="text/css">
   svg{
       max-height: 600px;
   }
    .addting{
     cursor:url('ting.ico'),pointer;
    }
   </style>
  <link rel="stylesheet" type="text/css" href="svg.select.css" />
<body>
    <div id="canvas1" style="border:1px dashed rgb(33, 159, 175);min-height:600px;"></div>
    <svg xmlns xmlns="http://www.w3.org/2000/svg">
        <defs>
            <pattern id="patter-0" width="200px" height="200px" patternUnits ="userSpaceOnUse">
                <image width="200px" height="200px" preserveAspectRatio="none" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="111.png">
                </image>
            </pattern>
        </defs>
    </svg>
    <div>
        <button onclick="CreateRect()">创建方块</button>
        <button onclick="CreateCircle()">创建圆形</button>
        <button onclick="CreateChuangKuang()">创建窗框</button>
        <button onclick="CreateBoli()">创建玻璃</button>
        <button onclick="CreateHengZhongTing()">创建横中梃</button>
        <button onclick="CreateShuZhongTing()">创建竖中梃</button>
        <button onclick="CreateYaXian()">创建压线</button>
        <button onclick="AddCZ()">填充材质</button>
        <button onclick="GetXY()">获取坐标</button>
    </div>
    <div>
        距上边距位置：
        <input type="text" placeholder="高" value="100" id="addlineheight">
        <button onclick="CreateLine()">加横线</button>
    </div>
    <div>
        距左边距位置：
        <input type="text" placeholder="高" value="100" id="addrowwidth">
        <button onclick="CreateRow()">加竖线</button>
    </div>
    <div id="divlast">
        <button onclick="DownLoad()">下载矢量图</button>
    </div>

    <script type="text/javascript" src="svg.js"></script>
    <script type="text/javascript" src="svg.draggable.js"></script>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="saveSvgAsPng.js"></script>
    <script type="text/javascript" src="assets/js/main.js"></script>
    <script type="text/javascript" src="svg.select.js"></script>
    
    <script type="text/javascript">
        var canvas1=null;
        var obj;
        var objdiv;
        var startx=50;//起始位置
        var starty=50;
        var kuangzongkuan=400;//框总宽
        var kuangzonggao=400;
        var yaxiankuan=5;//压线宽
        var kuangkuan=10;//框宽
        var tingkuan=8;//梃宽
        checkCanvas1()
        function checkCanvas1()
        {
            if(canvas1==null)
            {
                canvas1 = SVG('canvas1').size('100%', '600px');
            }
        }
        function CreateRect() {
            var rect = canvas1.rect('20%', '20%');
            rect.attr({ 'fill': '#496E91', 'stroke': 'pink' });
            rect.draggable();
            rect.id('rect1');
            //rect.select();//select 插件选中
        }
        function CreateCircle() {
            var rect = canvas1.circle(50);
            rect.attr({ 'fill': '#FFC23E', 'stroke': 'pink' });
            rect.draggable();   
        }
        function CreateChuangKuang() { 
             //var nested = canvas1.nested();
             //var r1 = nested.rect(400, 400);
             var group = canvas1.group();
             group.id("gdefault");

             var groupkuang = canvas1.group();
             groupkuang.id("g1");
             var r1 = canvas1.rect(kuangzongkuan, kuangzonggao).fill('#b2d1ee').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx,'y':starty});//窗框rect
             var r2 = canvas1.rect(kuangzongkuan-2*kuangkuan, kuangzonggao-2*kuangkuan).fill('#b2d1ee').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx+kuangkuan,'y':starty+kuangkuan});//压线rect
             var r3 = canvas1.rect(kuangzongkuan-2*kuangkuan-2*yaxiankuan, kuangzonggao-2*kuangkuan-2*yaxiankuan).fill('#eff5ea').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx+kuangkuan+yaxiankuan,'y':starty+kuangkuan+yaxiankuan});//玻璃rect
             r3.id("r3");
             r2.id("r2");
             r3.on('mousedown', function(e){
                r2.selectize();
               
             }, false);
            //框line
             var linekuang1 = canvas1.line(50,50, 60, 60).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var linekuang2 = canvas1.line(450, 50, 440, 60).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var linekuang3 = canvas1.line(450, 450, 440, 440).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var linekuang4 = canvas1.line(50, 450, 60, 440).attr({ 'stroke': 'black', 'stroke-width': 1 });

             //压线line
             var lineyaxian1 = canvas1.line(60,60, 65, 65).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var lineyaxian2 = canvas1.line(440, 60, 435, 65).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var lineyaxian3 = canvas1.line(440, 440, 435, 435).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var lineyaxian4 = canvas1.line(60, 440, 65, 435).attr({ 'stroke': 'black', 'stroke-width': 1 });
            
             //玻璃line
             var linebl1 = canvas1.line(245, 250, 250, 245).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var linebl2 = canvas1.line(240, 260, 260, 240).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var linebl3 = canvas1.line(255, 250, 250, 255).attr({ 'stroke': 'black', 'stroke-width': 1 });

             groupkuang.add(r1);
             groupkuang.add(r2);
             groupkuang.add(r3);
             groupkuang.add(linekuang1);
             groupkuang.add(linekuang2);
             groupkuang.add(linekuang3);
             groupkuang.add(linekuang4);
             groupkuang.add(lineyaxian1);
             groupkuang.add(lineyaxian2);
             groupkuang.add(lineyaxian3);
             groupkuang.add(lineyaxian4);
             groupkuang.add(linebl1);
             groupkuang.add(linebl2);
             groupkuang.add(linebl3);
             //下标尺
             var grouplinew = canvas1.group();
              grouplinew.id("gw");
              var linew = canvas1.line(50,500, 450, 500).attr({ 'stroke': 'black', 'stroke-width': 1 });
              var linew1 = canvas1.line(50, 490, 50, 510).attr({ 'stroke': 'black', 'stroke-width': 1 });
              var linew2 = canvas1.line(450, 490, 450, 510).attr({ 'stroke': 'black', 'stroke-width': 1 });
              var textw = canvas1.text(function(add) {
                add.tspan('200').dx(240).dy(520);
                });
              grouplinew.add(linew);
              grouplinew.add(linew1);
              grouplinew.add(linew2);
              grouplinew.add(textw);

              //右标尺
              var grouplineh = canvas1.group();
              grouplineh.id("gh");
              var lineh = canvas1.line(500,50, 500, 450).attr({ 'stroke': 'black', 'stroke-width': 1 });
              var lineh1 = canvas1.line(490, 50, 510, 50).attr({ 'stroke': 'black', 'stroke-width': 1 });
              var lineh2 = canvas1.line(490, 450, 510, 450).attr({ 'stroke': 'black', 'stroke-width': 1 });
              var texth = canvas1.text(function(add) {
                add.tspan('200').dx(520).dy(240);
                });
              grouplineh.add(lineh);
              grouplineh.add(lineh1);
              grouplineh.add(lineh2)
              grouplineh.add(texth);
         
         
             //var lineyaxian4 = canvas1.line(60, 440, 65, 435).attr({ 'stroke': 'black', 'stroke-width': 1 });
             //var localXY=document.getElementById("g1").getBoundingClientRect();
             //var r3 = canvas1.rect(200, 50).fill('#496E91');
            group.add(groupkuang);
            group.add(grouplinew);
            group.add(grouplineh);
            
            group.draggable();
            //AddEvent(r2);
            //var r1=SVG.get('rect1');
            //var r2=canvas1.nested();
            //var group = r2.group();
            //console.log(r2);
            //r2.size(300, 300);
            //r1.size(300, 300);
            //r1.move(100,100);
            //rect.draggable();   
         }
        function GetXY() { 
            console.log(document.getElementById("g1").getBBox());
            console.log(document.getElementById("g1").getBoundingClientRect());
            console.log(document.getElementById("canvas1").getBoundingClientRect());
         }
        function CreateHengZhongTing() {
            //obj.attr({fill: 'red','stroke-width': 3});
            var XY=document.getElementById("g1").getBoundingClientRect();
            var divXY=document.getElementById("canvas1").getBoundingClientRect();
            console.log(XY);
            console.log(divXY);
            var x = (XY.x-divXY.x);
            var xy =  XY.height/2+XY.y-divXY.y;
            var x2x= XY.width+XY.x-divXY.x;
            var x2y=XY.height/2+XY.y-divXY.y;
            console.log(x,xy,x2x,x2y);
            //var nested =  SVG('r2').nested();

            var rect = canvas1.line(x, xy, x2x, x2y).attr({ 'stroke': '#953734', 'stroke-width': 6 });

            var hengting = canvas1.rect(tingkuan,kuangzonggao-(2*kuangkuan)).fill('#b2d1ee').attr({ 'stroke': 'black', 'stroke-width':1,'x':(kuangzongkuan/2)+startx-(tingkuan/2),'y':(starty+kuangkuan)});
            var hengtingtopyaxian = canvas1.rect(kuangzongkuan/2-tingkuan/2-kuangkuan,kuangzongkuan-kuangkuan*2).fill('#b2d1ee').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx+kuangzongkuan/2+tingkuan/2,'y':starty+kuangkuan});
            var hengtingunderboli = canvas1.rect(kuangzongkuan/2-tingkuan/2-kuangkuan-2*yaxiankuan,kuangzongkuan-2*kuangkuan-2*yaxiankuan).fill('#eff5ea').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx+kuangzongkuan/2+tingkuan/2+yaxiankuan,'y':starty+kuangkuan+yaxiankuan});
            
            var hengtingrightyaxian = canvas1.rect(kuangzongkuan/2-tingkuan/2-kuangkuan,kuangzongkuan-kuangkuan*2).fill('#b2d1ee').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx+kuangzongkuan/2+tingkuan/2,'y':starty+kuangkuan});
            var hengtingrightboli = canvas1.rect(kuangzongkuan/2-tingkuan/2-kuangkuan-2*yaxiankuan,kuangzongkuan-2*kuangkuan-2*yaxiankuan).fill('#eff5ea').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx+kuangzongkuan/2+tingkuan/2+yaxiankuan,'y':starty+kuangkuan+yaxiankuan});

            AddEvent(rect);
            rect.draggable();
        }
        function CreateShuZhongTing() {//创建中挺，删除最上层玻璃  删除压线  删除line   加入梃两侧的玻璃
        
            var XY=document.getElementById("g1").getBoundingClientRect();
            var divXY=document.getElementById("canvas1").getBoundingClientRect();
            var x =  XY.x-divXY.x+XY.width/2;
            var xy = (XY.y-divXY.y);
            var x2x=XY.x-divXY.x+XY.width/2;
            var x2y=XY.height+XY.y-divXY.y;
            //var nested =  SVG('r2').nested();
            //var rect = canvas1.line(x, xy, x2x, x2y).attr({ 'stroke': '#953734', 'stroke-width': 6 });

            var shuting = canvas1.rect(tingkuan,kuangzonggao-(2*kuangkuan)).fill('#b2d1ee').attr({ 'stroke': 'black', 'stroke-width':1,'x':(kuangzongkuan/2)+startx-(tingkuan/2),'y':(starty+kuangkuan)});
            var shutingleftyaxian = canvas1.rect(kuangzongkuan/2-tingkuan/2-kuangkuan,kuangzongkuan-kuangkuan*2).fill('#b2d1ee').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx+kuangkuan,'y':starty+kuangkuan});
            var shutingleftboli = canvas1.rect(kuangzongkuan/2-tingkuan/2-kuangkuan-2*yaxiankuan,kuangzongkuan-2*kuangkuan-2*yaxiankuan).fill('#eff5ea').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx+kuangkuan+yaxiankuan,'y':starty+kuangkuan+yaxiankuan});
            
            var shutingrightyaxian = canvas1.rect(kuangzongkuan/2-tingkuan/2-kuangkuan,kuangzongkuan-kuangkuan*2).fill('#b2d1ee').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx+kuangzongkuan/2+tingkuan/2,'y':starty+kuangkuan});
            var shutingrightboli = canvas1.rect(kuangzongkuan/2-tingkuan/2-kuangkuan-2*yaxiankuan,kuangzongkuan-2*kuangkuan-2*yaxiankuan).fill('#eff5ea').attr({ 'stroke': 'black', 'stroke-width':1,'x':startx+kuangzongkuan/2+tingkuan/2+yaxiankuan,'y':starty+kuangkuan+yaxiankuan});
            
            var lineyaxian1 = canvas1.line(startx+kuangkuan,starty+kuangkuan, startx+kuangkuan+yaxiankuan,starty+kuangkuan+yaxiankuan).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var lineyaxian2 = canvas1.line(440, 60, 435, 65).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var lineyaxian3 = canvas1.line(440, 440, 435, 435).attr({ 'stroke': 'black', 'stroke-width': 1 });
             var lineyaxian4 = canvas1.line(60, 440, 65, 435).attr({ 'stroke': 'black', 'stroke-width': 1 });
            //shutingleftyaxian.id("shutingleftyaxian");
            //var g1=SVG.get('g1');
            //SVG.get('r2').remove();
            //SVG.get('r3').remove();
            //g1.add(shuting);
            //AddEvent(rect);     
            //rect.draggable();
            
        }
        function AddEvent(obj)
        {
            obj.dblclick(function() {
                this.attr({ 'stroke': 'white' , 'stroke-width': 1,'stroke-dasharray': 5});  
            });
        }
        function CreateBoli()//右上角加玻璃
        {
            var XY=document.getElementById("r2").getBoundingClientRect();
            var divXY=document.getElementById("canvas1").getBoundingClientRect();
            var x =  XY.x-divXY.x+XY.width/2;
            var xy = (XY.y-divXY.y);
            var x2x= XY.width+XY.x-divXY.x;
            var x3x=(XY.height+XY.y-divXY.y)/2;
            var a='M'+x+' '+xy+' H '+x2x+' V '+x3x+' H '+x+' Z';
            console.log(a);
            var aaa=canvas1.path(a);
            aaa.id('boli1');
            aaa.ad(boli1);
        }
        function AddCZ()
        {
           var boli1= SVG.get('boli1');
            //aaa.id('boli1');
            //<image width="100%" height="100%" x="0" y="0" stroke="black" xlink:href="111.png"></image>
            boli1.attr({ 'fill': 'url(#patter-0)' });
        }
        function DownLoad() {
            saveSvgAsPng(obj.parent.node, "test.png");
            // var canvas = obj.parent.node;
            // svgAsPngUri(canvas, null, function(uri) {
            // var a = document.createElement('a');
            // a.href = uri;  //将画布内的信息导出为png图片数据
            // a.download = "test";  //设定下载名称
            // a.click(); //点击触发下载
            //});
           
        }
    </script>
</body>

</html>